@model MyOnlineClinic.Web.Models.AppointmentViewModel
@{
    ViewBag.Title = "UpdateProfile";
    Layout = "~/Areas/Doctor/Views/Shared/_DoctorPartial.cshtml";

}
<script src="~/AdminAssets/js/jquery.min.js"></script>
<script src="~/AdminAssets/js/bootstrap.min.js"></script>
<style>
    /********************************MY Messages Page**************************************/


    .msg_li {
        background: #fafafa; /* Old browsers */
        /* IE9 SVG, needs conditional override of 'filter' to 'none' */
        background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIxMiUiIHN0b3AtY29sb3I9IiNmYWZhZmEiIHN0b3Atb3BhY2l0eT0iMSIvPgogICAgPHN0b3Agb2Zmc2V0PSI1MiUiIHN0b3AtY29sb3I9IiNlOWU5ZTkiIHN0b3Atb3BhY2l0eT0iMSIvPgogICAgPHN0b3Agb2Zmc2V0PSI5MyUiIHN0b3AtY29sb3I9IiNkM2QzZDMiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
        background: -moz-linear-gradient(top, #fafafa 12%, #e9e9e9 52%, #d3d3d3 93%); /* FF3.6+ */
        background: -webkit-gradient(linear, left top, left bottom, color-stop(12%,#fafafa), color-stop(52%,#e9e9e9), color-stop(93%,#d3d3d3)); /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top, #fafafa 12%,#e9e9e9 52%,#d3d3d3 93%); /* Chrome10+,Safari5.1+ */
        background: -o-linear-gradient(top, #fafafa 12%,#e9e9e9 52%,#d3d3d3 93%); /* Opera 11.10+ */
        background: -ms-linear-gradient(top, #fafafa 12%,#e9e9e9 52%,#d3d3d3 93%); /* IE10+ */
        background: linear-gradient(to bottom, #fafafa 12%,#e9e9e9 52%,#d3d3d3 93%); /* W3C */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fafafa', endColorstr='#d3d3d3',GradientType=0 ); /* IE6-8 */
        -webkit-box-shadow: 0 8px 3px -5px #858585;
        -moz-box-shadow: 0 8px 3px -5px #858585;
        box-shadow: 0 8px 3px -5px #858585;
        border: 1px solid #CCCCCC;
        border-radius: 8px;
        box-shadow: 0 8px 3px -5px #858585;
        display: block;
        line-height: 22px;
        padding: 10px 15px;
        margin: 8px 0px;
    }

    .textstyle {
        height: 75px;
        color: black;
        font-size: 14px;
        font-family: sans-serif;
        height: 170px;
    }

    .table-icons.textstyle.capitalize_first_letter b {
        line-height: 25px;
    }

    .modal-backdrop {
        z-index: 0;
    }

    .chat {
        list-style: none;
        margin: 0;
        padding: 0;
    }

        .chat li {
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px dotted #B3A9A9;
            width: 100%;
        }

            .chat li.left .chat-body {
                margin-left: 60px;
            }

            .chat li.right .chat-body {
                margin-right: 60px;
            }


            .chat li .chat-body p {
                margin: 0;
                color: #777777;
            }

        .panel .slidedown .glyphicon, .chat .glyphicon {
            margin-right: 5px;
        }

    .panel-body {
        overflow-y: scroll;
        height: 250px;
    }

    ::-webkit-scrollbar-track {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        background-color: #F5F5F5;
    }

    ::-webkit-scrollbar {
        width: 12px;
        background-color: #F5F5F5;
    }

    ::-webkit-scrollbar-thumb {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
        background-color: #555;
    }
    /* Tabs panel */
    .tabbable-panel {
        border: 1px solid #eee;
        padding: 10px;
    }

    /* Default mode */
    .tabbable-line > .nav-tabs {
        border: none;
        margin: 0px;
    }

        .tabbable-line > .nav-tabs > li {
            margin-right: 2px;
        }

            .tabbable-line > .nav-tabs > li > a {
                border: 0;
                margin-right: 0;
                color: #737373;
            }

                .tabbable-line > .nav-tabs > li > a > i {
                    color: #a6a6a6;
                }

            .tabbable-line > .nav-tabs > li.open, .tabbable-line > .nav-tabs > li:hover {
                border-bottom: 4px solid #fbcdcf;
            }

                .tabbable-line > .nav-tabs > li.open > a, .tabbable-line > .nav-tabs > li:hover > a {
                    border: 0;
                    background: none !important;
                    color: #333333;
                }

                    .tabbable-line > .nav-tabs > li.open > a > i, .tabbable-line > .nav-tabs > li:hover > a > i {
                        color: #a6a6a6;
                    }

                .tabbable-line > .nav-tabs > li.open .dropdown-menu, .tabbable-line > .nav-tabs > li:hover .dropdown-menu {
                    margin-top: 0px;
                }

            .tabbable-line > .nav-tabs > li.active {
                border-bottom: 4px solid #f3565d;
                position: relative;
            }

                .tabbable-line > .nav-tabs > li.active > a {
                    border: 0;
                    color: #333333;
                }

                    .tabbable-line > .nav-tabs > li.active > a > i {
                        color: #404040;
                    }

    .tabbable-line > .tab-content {
        margin-top: -3px;
        background-color: #fff;
        border: 0;
        border-top: 1px solid #eee;
        padding: 15px 0;
    }

    .portlet .tabbable-line > .tab-content {
        padding-bottom: 0;
    }
</style>
<div id="content-wrapper">
    <div class="dhe-example-section" id="ex-1-2">
        <div class="col-sm-12">
            <div class="profilebody_rightcol">
                <div class="from_title" style="margin-top:18px;">
                    Patient  Message
                </div>
                <div class="tab-content">
                    <div class="x_panel">
                        <div class="panel with-nav-tabs panel-default" style="border-color: #d3d3d3;">
                            <div class="panel-heading">
                                <ul class="nav nav-tabs" style="width: 98%; text-align: center; border: none;">
                                    <li class="active"><a href="#tab1Appointment" data-toggle="tab">Appointment Requests</a></li>
                                    <li><a href="#tabMessages" data-toggle="tab">Admin Messages</a></li>
                                    <li><a href="#tabTestResult" data-toggle="tab">Tests Results</a></li>
                                    <li><a href="#tab1Script" data-toggle="tab">Script</a></li>
                                </ul>
                            </div>
                            <div class="panel-body">
                                <div class="tab-content">
                                    <div class="tab-pane fade in active" id="tab1Appointment" style="overflow: scroll; height: 480px; width: 100%;">
                                        <div class="msg_list" style="padding-right:10px;">
                                            @Html.ValidationMessage("Status")
                                            @Html.ValidationMessage("Reject")


                                            @foreach (var item in Model.AppointmentList)
                                            {
                                                <div class="msg_li">
                                                    <div class="table-icons textstyle capitalize_first_letter">
                                                        Appointment Made On : @item.AppointmentDateLocalText <br />
                                                        <b>
                                                            @item.PatientName <br />
                                                           Appointment On  @Convert.ToDateTime(item.AppointmentDateUtc).ToString("dd-MMM-yyyy hh:mm tt") <br />
                                                          
                                                            <br />
                                                            Consult Type: @item.AppointmentTypeText
                                                        </b><br />
                                                        <div class="form-group" style=" margin-top: 10px; float: right;">

                                                          
                                                        </div>

                                                    </div>
                                                </div><br />
                                            }

                                            <div class="msg_li">

                                                Nil

                                            </div>

                                        </div>
                                    </div>

                                    <div class="tab-pane fade in active" id="tabMessages">
                                        <div class="msg_list" style="overflow: scroll; height: 480px; width: 97%;">



                                            <div class="row">
                                                <div class="col-md-12">


                                                    <div class="tabbable-panel">
                                                        <div class="tabbable-line">
                                                            <ul class="nav nav-tabs ">
                                                                <li class="active">
                                                                    <a href="#tab_default_1" data-toggle="tab">
                                                                        Report A Problem
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a href="#tab_default_2" data-toggle="tab">
                                                                        Contact Us
                                                                    </a>
                                                                </li>

                                                            </ul>
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="tab_default_1">
                                                                    <p>
                                                                        @foreach (var item in Model.ReportProblem)
                                                                        {
                                                                            <div class="msg_li">

                                                                                <a class="link-reply problem" data-role="@item.ReportProblemId">@item.ReportProblemSubject</a>

                                                                            </div>}
                                                                    </p>

                                                                </div>
                                                                <div class="tab-pane" id="tab_default_2">
                                                                    <p>
                                                                        @foreach (var item in Model.ContactusList)
                                                                        {
                                                                            <div class="msg_li">

                                                                                <a class="link-reply contact" data-role="@item.contactid">@item.ContactUsMessage</a>

                                                                            </div>}
                                                                    </p>

                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>


                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="ChatModel" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">

        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">
                    <label id="lblTitle">Message</label>
                </h4>
            </div>
            <div class="modal-body">
                <div id="CreateEditForm">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                    <input type="hidden" id="hdnReplyid" />
                                    <input type="hidden" id="hdnContactReplyid" />
                                    <span class="glyphicon glyphicon-comment"></span> Chat

                                </div>
                                <div class="panel-body">
                                    <ul id="ulAdminReply" class="chat"></ul>
                                </div>
                                <div class="panel-footer">
                                    <div class="input-group">
                                        <input id="btn-input" type="text" class="form-control input-sm" placeholder="Type your message here..." />
                                        <span class="input-group-btn">
                                            <button class="btn btn-warning btn-sm" id="btn-chat">
                                                Send
                                            </button>
                                            <button class="btn btn-warning btn-sm" id="btn-contact">
                                                Send
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
</div>
<script id="templateAdmin" type="text/x-jquery-tmpl">
    <li class="left clearfix">
        <span class="chat-img pull-left">
            <img src="http://placehold.it/50/55C1E7/fff&text=U" alt="User Avatar" class="img-circle" />
        </span>
        <div class="chat-body clearfix">
            <div class="header">
                <strong class="primary-font">Admin</strong> <small class="pull-right text-muted">
                    <span class="glyphicon glyphicon-time"></span>12 mins ago
                </small>
            </div>
            <p>
                #Reply
            </p>
        </div>
    </li>
</script>
<script id="templateUser" type="text/x-jquery-tmpl">
    <li class="right clearfix">
        <span class="chat-img pull-right">
            <img src="http://placehold.it/50/FA6F57/fff&text=ME" alt="User Avatar" class="img-circle" />
        </span>
        <div class="chat-body clearfix">
            <div class="header">
                <small class=" text-muted"><span class="glyphicon glyphicon-time"></span>13 mins ago</small>
                <strong class="pull-right primary-font"> Me</strong>
            </div>
            <p>
                #Userreply
            </p>
        </div>
    </li>
</script>

<script type="text/javascript">
  

    $(".problem").click(function () {

        var hdnReplyid = document.getElementById('hdnReplyid');
        hdnReplyid.value = $(this).attr('data-role');

        var options = {
            "backdrop": "static"
        };
        $('#ChatModel').modal(options);

        $.ajax({
            type: 'GET',
            url: '/Patients/PatientMessage/GetAllReply',
            dataType: 'json',

            data: {

                problemid: hdnReplyid.value


            },
            success: function (data) {
                console.log(data);
                var templateAdmin = $('#templateAdmin');
                var templateUser = $('#templateUser');
                var ulAdminReply = $('#ulAdminReply');
                var appendString = '';

                $.each(data, function (key, value) {
                    if (value.RoleType == 3) {
                        appendString = templateUser.html();
                        appendString = appendString.replace('#Userreply', value.Message);
                        ulAdminReply.append(appendString);
                    }
                    else if (value.RoleType == 1) {
                        appendString = templateAdmin.html();
                        appendString = appendString.replace('#Reply', value.Message);
                        ulAdminReply.append(appendString);
                    }
                });

            },
            error: function (ex) {
            }
        });


    });

    $(document).on('click', '#btn-chat', function () {

        $.ajax({
            type: 'GET',
            url: '/Patients/PatientMessage/Reply',
            dataType: 'json',

            data: {

                reply: $("#btn-input").val(),
                id: $("#hdnReplyid").val()

            },
            success: function (data) {
                console.log(data);
                $.ajax({
                    type: 'GET',
                    url: '/Patients/PatientMessage/GetReply',
                    dataType: 'json',

                    data: {

                        Replyid: data.ReportProblemReplyId


                    },
                    success: function (data) {
                        console.log(data);

                        var templateAdmin = $('#templateAdmin');
                        var templateUser = $('#templateUser');
                        var ulAdminReply = $('#ulAdminReply');
                        var appendString = '';

                        $.each(data, function (key, value) {
                            if (value.RoleType == 3) {
                                appendString = templateUser.html();
                                appendString = appendString.replace('#Userreply', value.Message);
                                ulAdminReply.append(appendString);
                            }
                            else if (value.RoleType == 1) {
                                appendString = templateAdmin.html();
                                appendString = appendString.replace('#Reply', value.Message);
                                ulAdminReply.append(appendString);
                            }
                        });

                    },

                });

            },
            error: function (ex) {
            }
        });
    });

    $("#tab_default_1").click(function () {
        $("#btn-chat").show();
        $("#btn-contact").hide();
    });

    $("#tab_default_2").click(function () {
        $("#btn-chat").hide();
        $("#btn-contact").show();
    });

    $(".contact").click(function () {
        var ulAdminReply = $('#ulAdminReply');
        var hdnContactReplyid = document.getElementById('hdnContactReplyid');
        hdnContactReplyid.value = $(this).attr('data-role');
        ulAdminReply.html('');
        var options = {
            "backdrop": "static"
        };
        $('#ChatModel').modal(options);

        $.ajax({
            type: 'GET',
            url: '/Patients/PatientMessage/GetContactAllReply',
            dataType: 'json',

            data: {

                problemid: hdnContactReplyid.value


            },
            success: function (data) {
                console.log(data);
                var templateAdmin = $('#templateAdmin');
                var templateUser = $('#templateUser');

                var appendString = '';

                $.each(data, function (key, value) {
                    if (value.RoleType == 3) {
                        appendString = templateUser.html();
                        appendString = appendString.replace('#Userreply', value.Message);
                        ulAdminReply.append(appendString);
                    }
                    else if (value.RoleType == 1) {
                        appendString = templateAdmin.html();
                        appendString = appendString.replace('#Reply', value.Message);
                        ulAdminReply.append(appendString);
                    }
                });

            },
            error: function (ex) {
            }
        });


    });

    $(document).on('click', '#btn-contact', function () {

        $.ajax({
            type: 'GET',
            url: '/Patients/PatientMessage/ContactReply',
            dataType: 'json',

            data: {

                reply: $("#btn-input").val(),
                id: $("#hdnContactReplyid").val()

            },
            success: function (data) {
                console.log(data);
                $.ajax({
                    type: 'GET',
                    url: '/Patients/PatientMessage/GetContactReply',
                    dataType: 'json',

                    data: {

                        Replyid: data.ContactReplyId


                    },
                    success: function (data) {
                        console.log(data);

                        var templateAdmin = $('#templateAdmin');
                        var templateUser = $('#templateUser');
                        var ulAdminReply = $('#ulAdminReply');
                        var appendString = '';

                        $.each(data, function (key, value) {
                            if (value.RoleType == 3) {
                                appendString = templateUser.html();
                                appendString = appendString.replace('#Userreply', value.Message);
                                ulAdminReply.append(appendString);
                            }
                            else if (value.RoleType == 1) {
                                appendString = templateAdmin.html();
                                appendString = appendString.replace('#Reply', value.Message);
                                ulAdminReply.append(appendString);
                            }
                        });

                    },

                });

            },
            error: function (ex) {
            }
        });
    });







</script>
